@model HaveASeat.Models.Salone
 
@{
    Layout = "_DashboardLayout";
}
<!-- Header -->
<div class="header">
    <div class="header-title">
        <h1 class="dark:text-purple-400">Dashboard</h1>
        <p class="dark:text-neutral-50">Bentornato @ViewBag.NomeUtente</p>
    </div>

    <div class="header-actions">
        <button class="btn btn-outline">
            <i class="fas fa-download"></i> Esporta
        </button>
        <button class="btn btn-primary">
            <i class="fas fa-plus"></i> Aggiungi staff
        </button>
    </div>
</div>

<!-- Stats Cards -->
<div class="dashboard-stats">
    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-card-title">Prenotazioni Oggi</div>
            <div class="stat-card-icon icon-appointments">
                <i class="fas fa-calendar-check"></i>
            </div>
        </div>
        <div class="stat-card-value">24</div>
        <div class="stat-card-change change-positive">
            <i class="fas fa-arrow-up"></i> 12% rispetto a ieri
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-card-title">Nuovi Clienti</div>
            <div class="stat-card-icon icon-clients">
                <i class="fas fa-users"></i>
            </div>
        </div>
        <div class="stat-card-value">8</div>
        <div class="stat-card-change change-positive">
            <i class="fas fa-arrow-up"></i> 5% questa settimana
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-card-title">Incasso Giornaliero</div>
            <div class="stat-card-icon icon-revenue">
                <i class="fas fa-euro-sign"></i>
            </div>
        </div>
        <div class="stat-card-value">€1,240</div>
        <div class="stat-card-change change-positive">
            <i class="fas fa-arrow-up"></i> 8% rispetto a ieri
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div class="stat-card-title">Servizi Completati</div>
            <div class="stat-card-icon icon-services">
                <i class="fas fa-clipboard-check"></i>
            </div>
        </div>
        <div class="stat-card-value">18</div>
        <div class="stat-card-change change-negative">
            <i class="fas fa-arrow-down"></i> 3% rispetto a ieri
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="charts-section">
    <div class="chart-container">
        <div class="chart-header">
            <div class="chart-title">Prenotazioni e Incassi</div>
            <div class="chart-duration">
                <button class="duration-btn">Giorno</button>
                <button class="duration-btn active">Settimana</button>
                <button class="duration-btn">Mese</button>
            </div>
        </div>
        <div class="canvas-container">
            <canvas id="revenueChart"></canvas>
        </div>
    </div>

    <div class="chart-container top-services">
        <div class="chart-header">
            <div class="chart-title">Servizi Più Richiesti</div>
        </div>

        <div class="service-item">
            <div class="service-info">
                <div class="service-name">Taglio e Piega</div>
                <div class="service-bookings">34 prenotazioni</div>
            </div>
            <div class="service-revenue">€1,360</div>
        </div>

        <div class="service-item">
            <div class="service-info">
                <div class="service-name">Colorazione Capelli</div>
                <div class="service-bookings">28 prenotazioni</div>
            </div>
            <div class="service-revenue">€2,240</div>
        </div>

        <div class="service-item">
            <div class="service-info">
                <div class="service-name">Manicure</div>
                <div class="service-bookings">21 prenotazioni</div>
            </div>
            <div class="service-revenue">€840</div>
        </div>

        <div class="service-item">
            <div class="service-info">
                <div class="service-name">Trattamento Viso</div>
                <div class="service-bookings">15 prenotazioni</div>
            </div>
            <div class="service-revenue">€1,050</div>
        </div>

        <div class="service-item">
            <div class="service-info">
                <div class="service-name">Massaggio Rilassante</div>
                <div class="service-bookings">12 prenotazioni</div>
            </div>
            <div class="service-revenue">€960</div>
        </div>
    </div>
</div>

<!-- Appointments Section -->
<div class="section">
    <div class="section-title">
        <h2>Prenotazioni di Oggi</h2>
        <a href="#">Vedi tutte</a>
    </div>

    <div class="tabs">
        <div class="tab active">Tutti</div>
        <div class="tab">Confermati</div>
        <div class="tab">In attesa</div>
        <div class="tab">Cancellati</div>
    </div>

    <div class="card">
        <div class="appointment-header">
            <div class="appointment-date-filter">
                <button class="btn btn-outline">
                    <i class="fas fa-calendar"></i> Oggi
                </button>
            </div>

            <div class="appointment-search">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Cerca cliente o servizio...">
            </div>

            <div class="appointment-actions">
                <button class="btn btn-outline">
                    <i class="fas fa-filter"></i> Filtro
                </button>
            </div>
        </div>

        <div class="appointment-list">
            <table class="appointment-table">
                <thead>
                    <tr>
                        <th>Cliente</th>
                        <th>Servizio</th>
                        <th>Operatore</th>
                        <th>Orario</th>
                        <th>Prezzo</th>
                        <th>Stato</th>
                        <th>Azioni</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="client-name">Maria Rossi</div>
                            <div class="client-info">+39 333 1234567</div>
                        </td>
                        <td>Taglio e Piega</td>
                        <td>Luisa B.</td>
                        <td>10:00 - 11:00</td>
                        <td>€40</td>
                        <td><span class="status status-confirmed">Confermato</span></td>
                        <td>
                            <div class="appointment-actions-cell">
                                <button class="action-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn">
                                    <i class="fas fa-comment"></i>
                                </button>
                                <button class="action-btn">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="client-name">Francesca Bianchi</div>
                            <div class="client-info">+39 345 7654321</div>
                        </td>
                        <td>Manicure e Pedicure</td>
                        <td>Sara M.</td>
                        <td>11:30 - 13:00</td>
                        <td>€65</td>
                        <td><span class="status status-confirmed">Confermato</span></td>
                        <td>
                            <div class="appointment-actions-cell">
                                <button class="action-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn">
                                    <i class="fas fa-comment"></i>
                                </button>
                                <button class="action-btn">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="client-name">Marco Verdi</div>
                            <div class="client-info">+39 347 9876543</div>
                        </td>
                        <td>Barba e Capelli</td>
                        <td>Paolo R.</td>
                        <td>14:00 - 15:00</td>
                        <td>€35</td>
                        <td><span class="status status-pending">In attesa</span></td>
                        <td>
                            <div class="appointment-actions-cell">
                                <button class="action-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn">
                                    <i class="fas fa-comment"></i>
                                </button>
                                <button class="action-btn">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="client-name">Laura Neri</div>
                            <div class="client-info">+39 339 1122334</div>
                        </td>
                        <td>Trattamento Viso</td>
                        <td>Giulia T.</td>
                        <td>15:30 - 16:30</td>
                        <td>€70</td>
                        <td><span class="status status-cancelled">Cancellato</span></td>
                        <td>
            </table>


        </div>
    </div>
</div>


    <!-- Modal - Visible only when TempData is not null -->
    @if (TempData["SelectedPianoId"] != null)
    {
        <div x-data="{ open: true }">
            <div class="modal modal-open" x-show="open">
            <div class="modal-box w-11/12 max-w-4xl bg-white/90 backdrop-blur-sm shadow-2xl border border-white/20 dark:bg-gray-800">
                <!-- Modal Header -->
                <div class="flex items-center justify-between mb-6 pb-4 border-b border-gradient-to-r from-purple-200 to-indigo-200">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-xl flex items-center justify-center mr-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H3m2 0h3M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">Crea il tuo Salone</h2>
                            <p class="text-gray-600 dark:text-neutral-50">Configura i dettagli del tuo centro benessere</p>
                        </div>
                    </div>
                   
                        <button type="submit" name="ClearTempData" class="btn btn-sm btn-circle btn-ghost" x-on:click ="open = false">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                <!-- Stepper -->
                <ul class="steps mb-6">
                <li class="step step-primary px-3 dark:text-neutral-50" id="step1-indicator">Dati generali</li>
                <li class="step dark:text-neutral-50" id="step2-indicator">Dati fiscali</li>
                <li class="step dark:text-neutral-50" id="step3-indicator">Indirizzo</li>
                </ul>

                <!-- Modal Body -->
                <form method="post" action="/Partner/CreateSede" id="saloneForm" class="space-y-6">
                    <!-- STEP 1: Dati generali -->
                    <div id="step1">
                    <h3 class="text-lg font-semibold mb-4 dark:text-neutral-50">Informazioni Generali</h3>
                        <div class="form-control mb-3">
                        <label class="label dark:text-neutral-50">Nome Salone *</label>
                        <input asp-for="Nome" class="input input-bordered w-full"
                                   placeholder="Es. Beauty Center Roma" required />
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                            <div class="form-control">
                            <label class="label dark:text-neutral-50">Telefono *</label>
                                <input asp-for="Telefono" class="input input-bordered w-full"
                                       placeholder="Es. 3331234567" required />
                            </div>
                            <div class="form-control">
                            <label class="label dark:text-neutral-50">Email *</label>
                                <input asp-for="Email" class="input input-bordered w-full"
                                       placeholder="Es. info@beautycenter.it" required />
                            </div>
                        </div>
                        <div class="form-control mb-3">
                        <label class="label dark:text-neutral-50">Sito Web</label>
                            <input asp-for="SitoWeb" class="input input-bordered w-full"
                                   placeholder="Es. www.beautycenter.it" />
                        </div>
                        <div class="flex justify-end">
                            <button type="button"
                                    class="btn text-white bg-gradient-to-br from-purple-600 to-indigo-600"
                                    onclick="goToStep(2)">
                                Avanti
                            </button>
                        </div>
                    </div>

                    <!-- STEP 2: Dati fiscali -->
                    <div id="step2" class="hidden">
                    <h3 class="text-lg font-semibold mb-4 dark:text-neutral-50">Dati Fiscali</h3>
                        <div class="form-control mb-3">
                        <label class="label dark:text-neutral-50">Ragione Sociale *</label>
                            <input asp-for="RagioneSociale" class="input input-bordered w-full"
                                   placeholder="Es. Beauty Center Srl" required/>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                            <div class="form-control">
                            <label class="label dark:text-neutral-50">Partita IVA *</label>
                                <input asp-for="PartitaIVA" class="input input-bordered w-full"
                                       placeholder="Es. 12345678901" required/>
                            </div>
                            <div class="form-control">
                            <label class="label dark:text-neutral-50">Codice SDI *</label>
                                <input asp-for="SDI" class="input input-bordered w-full"
                                       placeholder="Es. ABCDEF1" required/>
                            </div>
                        </div>
                        <div class="flex justify-between">
                            <button type="button"
                                    class="btn btn-outline text-purple-600 border border-purple-600 hover:text-white hover:bg-purple-600"
                                    onclick="goToStep(1)">
                                Indietro
                            </button>
                            <button type="button"
                                    class="btn text-white bg-gradient-to-br from-purple-600 to-indigo-600"
                                    onclick="goToStep(3)">
                                Avanti
                            </button>
                        </div>
                    </div>

                    <!-- STEP 3: Indirizzo -->
                    <div id="step3" class="hidden">
                    <h3 class="text-lg font-semibold mb-4 dark:text-neutral-50">Indirizzo Salone</h3>
                        <div class="form-control mb-3">
                        <label class="label dark:text-neutral-50">Indirizzo *</label>
                            <input asp-for="Indirizzo" class="input input-bordered w-full"
                                   placeholder="Es. Via Roma, 10" required />
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                            <div class="form-control">
                            <label class="label dark:text-neutral-50">Città *</label>
                                <input asp-for="Citta" class="input input-bordered w-full"
                                       placeholder="Es. Roma" required />
                            </div>
                            <div class="form-control">
                            <label class="label dark:text-neutral-50">CAP *</label>
                                <input asp-for="CAP" class="input input-bordered w-full"
                                       placeholder="Es. 00100" required />
                            </div>
                            <div class="form-control">
                            <label class="label dark:text-neutral-50">Provincia *</label>
                                <input asp-for="Provincia" class="input input-bordered w-full"
                                       placeholder="Es. RM" required />
                            </div>
                        </div>
                        <div class="form-control mb-3">
                        <label class="label dark:text-neutral-50">Regione *</label>
                        <select asp-for="Regione" class="select select-bordered w-full dark:text-neutral-50" required>
                                <option value="">Seleziona Regione</option>
                                <option value="Abruzzo">Abruzzo</option>
                                <option value="Basilicata">Basilicata</option>
                                <option value="Calabria">Calabria</option>
                                <option value="Campania">Campania</option>
                                <option value="Emilia-Romagna">Emilia-Romagna</option>
                                <option value="Friuli-Venezia Giulia">Friuli-Venezia Giulia</option>
                                <option value="Lazio">Lazio</option>
                                <option value="Liguria">Liguria</option>
                                <option value="Lombardia">Lombardia</option>
                                <option value="Marche">Marche</option>
                                <option value="Molise">Molise</option>
                                <option value="Piemonte">Piemonte</option>
                                <option value="Puglia">Puglia</option>
                                <option value="Sardegna">Sardegna</option>
                                <option value="Sicilia">Sicilia</option>
                                <option value="Toscana">Toscana</option>
                                <option value="Trentino-Alto Adige">Trentino-Alto Adige</option>
                                <option value="Umbria">Umbria</option>
                                <option value="Valle d'Aosta">Valle d'Aosta</option>
                                <option value="Veneto">Veneto</option>
                            </select>
                        </div>
                        <div class="flex justify-between">
                            <button type="button"
                                    class="btn btn-outline text-purple-600 border border-purple-600 hover:text-white hover:bg-purple-600"                                 
                                    onclick="goToStep(2)">
                                Indietro
                            </button>
                            <button type="submit"
                                    class="btn text-white bg-gradient-to-br from-purple-600 to-indigo-600">
                                Crea Salone
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        </div>
    }

<script src="//unpkg.com/alpinejs" defer></script>
<script defer>
    function validateStep(stepNumber) {
        const currentStep = document.getElementById('step' + stepNumber);
        const requiredFields = currentStep.querySelectorAll('input[required], select[required]');

        // Usa la validazione nativa del browser
        for (let field of requiredFields) {
            if (!field.checkValidity()) {
                field.reportValidity(); // Mostra il tooltip nativo del browser
                return false;
            }
        }

        return true;
    }

    function goToStep(step) {
        // Se stiamo andando avanti (step > currentStep), valida prima
        const currentStepElement = document.querySelector('#saloneForm > div:not(.hidden)[id^="step"]');
        const currentStepNumber = currentStepElement ? parseInt(currentStepElement.id.replace('step', '')) : 1;

        if (step > currentStepNumber) {
            // Valida lo step corrente prima di procedere
            if (!validateStep(currentStepNumber)) {
                return; // Non procedere se la validazione fallisce
            }
        }

        // Nasconde tutti gli step
        document.querySelectorAll('#saloneForm > div[id^="step"]').forEach(div => div.classList.add('hidden'));
        // Mostra lo step desiderato
        document.getElementById('step' + step).classList.remove('hidden');
        // Aggiorna lo stepper DaisyUI
        document.querySelectorAll('.steps .step').forEach((li, idx) => {
            if (idx < step) li.classList.add('step-primary');
            else li.classList.remove('step-primary');
        });
    }

    // Validazione finale del form prima del submit
    function validateForm() {
        // Usa la validazione nativa del form
        const form = document.getElementById('saloneForm');
        return form.checkValidity();
    }

    // Inizializzazione
    document.addEventListener('DOMContentLoaded', function() {
        // Mostra lo step 1 all'avvio
        goToStep(1);

        // Aggiungi validazione al form submit
        const form = document.getElementById('saloneForm');
        if (form) {
            form.addEventListener('submit', function(e) {
                if (!validateForm()) {
                    e.preventDefault();
                    return false;
                }
            });
        }
    });
</script>
